```
CREATE TABLE dws_user_refund_summary AS
SELECT
  user_id,
  COUNT(*) AS refund_count,
  SUM(refund_amount) AS total_refund_amount,
  MIN(refund_time) AS first_refund_time,
  MAX(refund_time) AS last_refund_time,
  DATEDIFF(MAX(refund_time), MIN(refund_time)) AS refund_days_span,
  DATE_FORMAT(MAX(refund_time), 'yyyy-MM-dd') AS dt
FROM dwd_refund_detail
GROUP BY user_id;
```
