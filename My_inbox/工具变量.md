
工具变量是啥
[[读论文的一般模板]]







# 完整的串一下这个逻辑






以一篇文章里面的工具变量构建为例


好的，我来帮你详细讲解一下这段文字中关于内生性的部分。

这段文字主要讨论了在研究项目特征与已完成问题（ClosedIssues）之间关系时，如何解决内生性问题。内生性是指解释变量（例如，团队互动 TeamInteraction 和积极参与 ActiveParticipation）与误差项之间存在相关性，这会导致回归分析结果产生偏差。文章提到了三种可能导致内生性的挑战，并针对第三种挑战（反向因果关系）进行了详细的讨论和处理。

**内生性的来源与问题：**

1.  **时间不变的不可观测的项目特征：** 这类特征可能影响自变量和因变量之间的关系。文章使用项目固定效应来消除这类偏差。
2.  **时间变化的不可观测的项目特征：** 团队成员可能会根据对项目范围的理解程度调整他们的参与水平，这会造成偏差。文章使用工具变量法（IV）来校正 TeamInteraction 的内生性。
3.  **反向因果关系：** ClosedIssues 的变化可能会影响管理者积极参与项目活动的行为。例如，如果一个项目有很多问题被解决，管理者可能会减少参与，反之亦然。

**针对反向因果关系的处理方法：**

*   **将 ActiveParticipation 视为内生变量：** 因为 ActiveParticipation 和 ClosedIssues 之间可能存在反向因果关系，所以文章将其视为内生变量。
*   **采用工具变量（IV）回归：** 为了减轻反向因果关系带来的影响，文章采用了工具变量回归。具体来说，他们使用了基于异方差的工具变量（IVHI）方法。

**工具变量法（IVHI）的具体步骤：**

1.  **第一步：提取残差**
    *   使用普通最小二乘法（OLS）回归，分别对 TeamInteraction 和 ActiveParticipation 建立模型，公式如下：
        *   TeamInteraction$_{it}$ = $γ_{10}$ClosedIssues$_{it-1}$ + $γ_{11}$X$_{it}$ + T$_t$ + $ε_{1it}$
        *   ActiveParticipation$_{it}$ = $γ_{20}$ClosedIssues$_{it-1}$ + $γ_{21}$X$_{it}$ + T$_t$ + $ε_{2it}$
        *   其中：
            *   TeamInteraction$_{it}$ 和 ActiveParticipation$_{it}$ 是内生变量。
            *   ClosedIssues$_{it-1}$ 是滞后一期的 ClosedIssues。
            *   X$_{it}$ 是外生控制变量。
            *   T$_t$ 是时间固定效应。
            *   $ε_{1it}$ 和 $ε_{2it}$ 是残差项，分别代表 TeamInteraction 和 ActiveParticipation 中无法被模型解释的部分。
2.  **第二步：创建工具变量**
    *   利用第一步得到的残差，结合其他变量（TeamSize 和 Watch），创建工具变量：
        *   IVTeamInteraction = $ε_{1it}$ * (TeamSize$_{it}$ - TeamSize)
        *   IVActiveParticipation = $ε_{2it}$ * (Watch$_{it}$ - Watch)
        *   其中：
            *   TeamSize$_{it}$ 是项目团队规模。
            *   TeamSize 是 TeamSize$_{it}$ 的样本均值。
            *   Watch$_{it}$ 是 GitHub 上的项目关注数。
            *   Watch 是 Watch$_{it}$ 的样本均值。
    *   文章解释了为什么选择 TeamSize 和 Watch 作为工具变量的基础：
        *   TeamSize 与 TeamInteraction 相关：团队规模越大，沟通机会越多。
        *   Watch 与 ActiveParticipation 相关：项目关注度越高，吸引的开发者越多，需要的管理指导越少。
3.  **两阶段控制函数法**
    *   由于模型包含非线性和多个交互项，文章使用了两阶段控制函数法来处理内生性。
    *   **第一阶段：** 将 TeamInteraction 和 ActiveParticipation 对工具变量和外生控制变量进行回归：
        *   TeamInteraction$_{it}$ = $φ_{10}$ClosedIssues$_{it-1}$ + $φ_{11}$IVTeamInteraction + $φ_{12}$IVActiveParticipation + $φ_{13}$X$_{it}$ + T$_t$ + $μ_{1it}$
        *   ActiveParticipation$_{it}$ = $φ_{20}$ClosedIssues$_{it-1}$ + $φ_{21}$IVTeamInteraction + $φ_{22}$IVActiveParticipation + $φ_{2


好的，我们用费曼技巧来拆解一下这段关于内生性的讨论。想象一下，你要向一个完全不懂计量经济学的朋友解释这篇文章里遇到的内生性问题以及他们是如何解决的。


# 什么是内生性？内生性的来源

**1. 确定问题：什么是内生性？**


> [!NOTE] Unobservered correlation!
> 未被发现的隐藏因素
> 没说，但是和解决有关






想象一下，你想研究吃冰淇淋和溺水事件之间的关系。你发现吃冰淇淋越多，溺水事件也越多。你能不能说吃冰淇淋导致了溺水？很可能不是。**实际上，更可能是因为天气热，所以人们既吃更多冰淇淋，也更多地去游泳，导致溺水事件增加。**

内**生性就像这个例子里的“天气热”。** 它指的是，你想要研究的两个变量（比如这里的“吃冰淇淋”和“溺水”）之间的关系，实际上受到了一个你没有观察到的、或者没有考虑到的因素的影响。这个因素同时影响着这两个变量，让你误以为它们之间有直接的因果关系。

在这篇文章里，作者想研究项目特征（比如团队互动和积极参与）和项目成功（已完成问题数量）之间的关系。但是，他们担心有一些“隐藏的因素”会同时影响团队的互动和项目的成功，从而让他们误判了团队互动对项目成功的真正影响。

**2. 识别内生性的来源**

作者提到了三种可能的“隐藏因素”：

*   **项目自身的特点（不变的）：** 比如，有些项目天生就比较容易成功，也更容易吸引团队成员积极互动。
*   **项目特点随时间变化：** 比如，团队成员对项目的理解会随着时间而变化，从而影响他们的参与程度。
*   **反向因果关系：** 这就是说，不一定是团队互动影响了项目成功，也可能是项目成功反过来影响了团队互动。比如，如果一个项目进展顺利，管理者可能就会减少干预，让团队自由发挥。

# 工具变量法如何解决内生性问题
**3. 解决内生性的方法：工具变量法**




> [!NOTE] 解决方法
> 1. 和核心解释变量相关
> 2. 但是不能直接影响结果



假设我们选择了“当地冰淇淋店的数量”作为工具变量，并进行了两阶段最小二乘法（2SLS）回归。

> [!NOTE]
> **第一阶段：**
> 
> 我们用“当地冰淇淋店的数量”来预测“冰淇淋销量”。回归方程可能是这样的：
> 
> *   冰淇淋销量 = $α$ + $β$ * 冰淇淋店数量 + 其他控制变量 + 误差项
> 
> 如果“冰淇淋店数量”的系数 $β$ 显著为正，说明我们的工具变量与内生变量（冰淇淋销量）是相关的，满足工具变量的第一个条件。

**第二阶段：**

> [!NOTE]
> 我们用第一阶段预测出来的“冰淇淋销量”来预测“溺水事件数量”。回归方程可能是这样的：
> 
> *   溺水事件数量 = $γ$ + $δ$ * 预测的冰淇淋销量 + 其他控制变量 + 误差项
> 
> 这里的“预测的冰淇淋销量”是第一阶段回归得到的拟合值，它代表了冰淇淋销量中那些可以被“冰淇淋店数量”解释的部分，也就是排除了“天气热”等混淆因素影响的部分。

**可能的结果和解读：**

1.  **如果 $δ$ 显著为正：**
    *   这说明在控制了“天气热”等混淆因素后，冰淇淋销量仍然与溺水事件数量显著相关。
    *   这可能意味着，冰淇淋销量和溺水事件之间确实存在某种因果关系，或者存在其他我们没有考虑到的混淆因素。
    *   需要注意的是，这并不一定意味着“吃冰淇淋导致溺水”，而可能只是说明，在某些情况下，吃冰淇淋多的人群也更容易发生溺水事件。

2.  **如果 $δ$ 不显著：**
    *   这说明在控制了“天气热”等混淆因素后，冰淇淋销量与溺水事件数量之间没有显著的相关关系。
    *   这可能意味着，我们之前观察到的冰淇淋销量和溺水事件之间的相关关系，实际上是由“天气热”等混淆因素导致的。
    *   在这种情况下，我们就不能得出“冰淇淋销量会影响溺水事件数量”的结论。



> [!NOTE] 为什么有效？为什么冰淇淋店把天热的因素就给控制了呢？
> 内生变量（Endogenous Variable）是指在一个模型中，其数值由模型内部其他变量决定的变量。换句话说，内生变量的值受到模型中其他变量的影响，并且反过来也会影响模型中的其他变量。
> 
> 
> 
> 

工具变量法的核心思想是，将内生变量（这里是冰淇淋销量）分解成两部分：

- **受工具变量影响的部分：** 这部分冰淇淋销量是由冰淇淋店的数量决定的，与“天气热”无关。
- **不受工具变量影响的部分：** 这部分冰淇淋销量可能受到“天气热”等其他因素的影响。



> [!NOTE]
> 1. **第一阶段回归的作用：**
>     
>     - 在第一阶段回归中，我们用冰淇淋店的数量来预测冰淇淋销量。
>     - 这个回归的目的，是提取出冰淇淋销量中那些可以被冰淇淋店数量解释的部分。
>     - 这部分冰淇淋销量，可以认为是“由供给决定的冰淇淋销量”，它与“天气热”无关。
> 
> 

> [!NOTE]
> 1. **第二阶段回归的作用：**
>     
>     - 在第二阶段回归中，我们只使用第一阶段预测出来的“由供给决定的冰淇淋销量”来研究它与溺水事件之间的关系。
>     - 由于这部分冰淇淋销量与“天气热”无关，所以我们就可以排除“天气热”对冰淇淋销量和溺水事件之间关系的干扰。






为了解决内生性问题，作者使用了“工具变量法”。你可以把它想象成一个“侦探”，帮助你找到真正的因果关系。

*   **寻找“工具”：** 这个“侦探”需要一个“工具”，也就是“工具变量”。这个工具变量必须满足两个条件：
    *   它必须和你想研究的那个变量（比如团队互动）相关。
    *   它不能直接影响你想要研究的结果（比如项目成功），只能通过影响那个变量来间接影响结果。

> [!NOTE]
>     在这篇文章里，作者找到了两个“工具”：团队规模（TeamSize）和项目关注度（Watch）。他们认为，团队规模会影响团队互动，但不会直接影响项目成功；项目关注度会影响管理者的参与程度，但不会直接影响项目成功。
> 

*   **两阶段法：** 有了“工具”，就可以开始“破案”了。工具变量法通常分为两个阶段：
    *   **第一阶段：** 用“工具变量”来预测你想研究的那个变量（比如团队互动）。
    *   **第二阶段：** 用第一阶段预测出来的“团队互动”来研究它对项目成功的影响。

    这样做的目的是，把“团队互动”中那些受到“隐藏因素”影响的部分剔除掉，只留下那些真正由“工具变量”决定的部分，从而更准确地评估“团队互动”对项目成功的真正影响。

**4. 控制函数法**

由于模型比较复杂，作者使用了两阶段控制函数法。简单来说，这种方法和工具变量法的思路类似，也是为了把内生变量中受干扰的部分剔除掉，从而得到更准确的估计结果。

**总结：**

内生性就像是隐藏在变量关系背后的“捣蛋鬼”，会让你误以为两个变量之间有直接的因果关系。为了抓住这个“捣蛋鬼”，你需要找到一个“工具”，也就是工具变量，然后用工具变量法来清理掉内生变量中受干扰的部分，从而更准确地评估变量之间的真正关系。

希望这个解释能够帮助你理解这篇文章中关于内生性的讨论。如果你还有什么不明白的地方，可以继续提问。

# IV与控制函数

好的，我们来一起梳理一下这段文字中关于内生性处理的问题，用更清晰的方式呈现出来。

**研究背景**

研究目标是探究项目中的团队互动（TeamInteraction）和积极参与（ActiveParticipation）等因素如何影响已完成的问题数量（ClosedIssues）。

**面临的挑战：内生性**

研究者意识到，TeamInteraction 和 ActiveParticipation 这两个变量很可能存在内生性问题。这意味着，这些变量与模型中的误差项可能存在相关性，导致使用传统回归方法得到的结论不可靠。

**为什么存在内生性？**

*   **反向因果关系：** 可能不是团队互动影响了已完成问题数量，而是已完成问题数量反过来影响了团队互动。例如，当项目进展顺利，问题解决得很快时，团队互动的需求可能会降低。
*   **遗漏变量：** 可能存在一些无法观测的因素同时影响了团队互动和已完成问题数量。

**研究方法：控制函数法（Control Function Approach）**

为了解决内生性问题，研究者采用了控制函数法。控制函数法是一种常用的处理内生性问题的计量经济学方法。

**控制函数法的核心思想**

控制函数法的核心思想是，通过以下步骤将内生变量中与误差项相关的部分分离出来，并在回归模型中加以控制，从而得到无偏的估计结果。

**控制函数法的具体步骤**

1.  **第一阶段：**
    *   **目的：** 估计内生变量中与工具变量相关的部分。
    *   **方法：** 将内生变量（TeamInteraction 和 ActiveParticipation）分别对工具变量（IVTeamInteraction 和 IVActiveParticipation）以及其他外生控制变量进行回归。
    *   **公式：**
        *   TeamInteraction$_{it}$ = $φ_{10}$ClosedIssues$_{it-1}$ + $φ_{11}$IVTeamInteraction + $φ_{12}$IVActiveParticipation + $φ_{13}$X$_{it}$ + T$_t$ + $μ_{1it}$
        *   ActiveParticipation$_{it}$ = $φ_{20}$ClosedIssues$_{it-1}$ + $φ_{21}$IVTeamInteraction + $φ_{22}$IVActiveParticipation + $φ_{23}$X$_{it}$ + T$_t$ + $μ_{2it}$
    *   **结果：** 得到残差项 $μ_{1it}$ 和 $μ_{2it}$。这两个残差项包含了内生变量中无法被工具变量解释的部分，也就是可能与误差项相关的部分。

2.  **第二阶段：**
    *   **目的：** 在主回归模型中控制内生性。
    *   **方法：** **将残差项 $μ_{1it}$ 和 $μ_{2it}$ 作为控制变量加入到主回归模型中。**
    *   **公式：**
        *   ClosedIssues$_{it}$ = $β_{10}$ClosedIssues$_{it-1}$ + $β_{11}$TeamInteraction$_{it}$ + $β_{12}$TeamInteraction$^2$$_{it}$ + $β_{13}$ActiveParticipation$_{it}$ + $β_{14}$X$_{it}$ + $β_{15}$$μ_{1it}$ + $β_{16}$$μ_{2it}$ + T$_t$ + $e_{it}$
        *   ClosedIssues$_{it}$ = $β_{20}$ClosedIssues$_{it-1}$ + $β_{21}$TeamInteraction$_{it}$ + $β_{22}$TeamInteraction$^2$$_{it}$ + $β_{23}$ActiveParticipation$_{it}$ + $β_{24}$(TeamInteraction$_{it}$ * ActiveParticipation$_{it}$) + $β_{25}$(TeamInteraction$^2$$_{it}$ * ActiveParticipation$_{it}$) + $β_{26}$X$_{it}$ + $β_{27}$$μ_{1it}$ + $β_{28}$$μ_{2it}$ + T$_t$ + $e_{it}$
    *   **结果：** 通过控制残差项，可以得到 TeamInteraction 和 ActiveParticipation 对 ClosedIssues 的无偏估计。

**工具变量的有效性检验**

为了保证控制函数法的有效性，研究者需要检验工具变量是否满足以下两个条件：

1.  **外生性：** 工具变量与误差项不相关。
    *   **检验方法：** Pagan-Hall test
    *   **结果：** Pagan-Hall 检验结果表明，残差项的平方与工具变量之间不存在相关性，满足外生性条件。

2.  **相关性：** 工具变量与内生变量相关。
    *   **检验方法：** Breusch-Pagan test for heteroskedasticity, F-statistic
    *   **结果：** Breusch-Pagan 检验结果表明，残差项存在异方差性，说明工具变量与内生变量相关。F 统计量也远大于 Stock 和 Yogo (2002) 提出的临界值，进一步验证了工具变量的相关性。

**结论**

通过使用控制函数法和有效的工具变量，研究者能够有效地解决内生性问题，从而得到关于 TeamInteraction 和 ActiveParticipation 对 ClosedIssues 影响的可靠结论。

**总结**

这段文字描述了研究者如何使用控制函数法来处理内生性问题。控制函数法的核心思想是将内生变量中与误差项相关的部分分离出来，并在回归模型中加以控制。为了保证控制函数法的有效性，研究者还需要检验工具变量是否满足外生性和相关性条件。
